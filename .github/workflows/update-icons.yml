name: UPDATE-ICONS

on:
  workflow_dispatch:
    inputs:
      figma_link:
        description: "Icon groups link in figma"
        required: true

jobs:
  UPDATE_ICONS:
    name: "Update Icons"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 14
          cache: "yarn"
      - uses: actions/cache@v3
        id: yarn-cache
        with:
          path: "**/node_modules"
          key: ${{ runner.os }}-modules-${{ hashFiles('**/yarn.lock') }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - name: Install dependencies
        run: yarn install --frozen-lockfile
      - name: Fetch Icons
        run: echo ${{ github.event.inputs.figma_link }} > test.txt
      - name: Check Diff
        run: if [ "$(git status -s)" = "" ]; then exit 0; fi;
      - name: Set outputs sha_short
        id: vars
        run: echo "::set-output name=sha_short::$(git rev-parse --short HEAD)"
      - name: Create Branch
        run: git checkout -b "icons-fetch/${{ steps.vars.outputs.sha_short }}"
      - name: Setup Git User
        run: git config user.name "argocd" && git config user.email "argocd@ui.com"
      - name: Commit Icons
        run: git add . && git commit -m "feat:update icons from github action"
      - name: Push Branch
        run: git push -u origin "icons-fetch/${{ steps.vars.outputs.sha_short }}"
      - name: Create PR
        run: gh pr create -t "Icons Fetched By Github Actions" -B v6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
